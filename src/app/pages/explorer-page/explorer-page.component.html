<app-protein-analysis [(show)]="showAnalysisDialog"></app-protein-analysis>

<div class="covex explorer">

  <div class="covex left-window">
    <div>
      <div class="covex bar-left">

        <div class="card bar-small">
          <header class="card-header">
            <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-database" aria-hidden="true"></i>
      </span> Choose Dataset
            </p>
          </header>
          <div class="card-content">
            <app-select-dataset [datasetItems]="datasetItems"  [selectedDataset]="selectedDataset"
                                (selectedDatasetChange)="selectedDataset = $event; createNetwork($event.data)">
            </app-select-dataset>

          </div>
        </div>

        <div class="card bar-medium">
          <header class="card-header">
            <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-info" aria-hidden="true"></i>
      </span> Network Overview
            </p>
          </header>
          <div class="card-content">
            <nav class="level" *ngIf="proteinData">
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Viral<br>Proteins</p>
                  <p class="title"> {{ proteinData.effects.length }}</p>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Host<br>Proteins</p>
                  <p class="title">{{ proteinData.proteins.length }}</p>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Virus-Host<br>Interactions</p>
                  <p class="title">{{ proteinData.edges.length }}</p>
                </div>
              </div>
            </nav>
          </div>
        </div>

        <div class="card bar-small">
          <header class="card-header">
            <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-search" aria-hidden="true"></i>
      </span> Query Protein
            </p>
          </header>
          <div class="card-content">
            <div class="field">
              <div class="control">
                <app-query-component [queryItems]="queryItems"
                                     (selectItem)="queryAction($event)"></app-query-component>
              </div>
            </div>
          </div>
        </div>

        <div class="card bar-large">
          <header class="card-header">
            <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-filter" aria-hidden="true"></i>
      </span> Filter Viral Proteins
            </p>
          </header>
          <div class="card-content overflow">
            <div *ngFor="let bait of viralProteinCheckboxes">
              <label class="checkbox">
                <input type="checkbox" class="checkbox" [ngModel]="bait.checked"
                       (ngModelChange)="bait.checked = $event; filterNodes()">
                {{ bait.data.effectName }}
              </label>
            </div>
          </div>
          <footer class="card-footer">
            <a (click)="reset($event);" class="card-footer-item has-text-danger">
              <span class="icon">
              <i class="fa fa-refresh"></i>
            </span>
              <span>
              Reset
            </span>
            </a>
          </footer>
        </div>
      </div>

      <div class="covex network">
        <div class="card network">
          <header class="card-header">
            <p class="card-header-title">
              Protein-Protein Interaction Network
            </p>
          </header>
          <div class="card-content">
            <div class="card-image" id="0">
              <div class="network center" #network>
                <button class="button is-loading center">Loading</button>
              </div>
            </div>
            <footer class="card-footer">
              <button (click)="toCanvas()" class="button is-primary">
                <span class="icon">
        <i class="fas fa-camera" aria-hidden="true"></i>
      </span> <span>Screenshot</span>
              </button>
              <div class="field has-addons footer-toggle-buttons">
                <p class="control">
                  <button class="button is-rounded" [class.is-primary]="physicsEnabled"
                          (click)="updatePhysicsEnabled(true)">
                <span class="icon is-small">
                  <i class="fas fa-wind"></i>
                </span>
                    <span>Animation On</span>
                  </button>
                </p>
                <p class="control">
                  <button class="button is-rounded" [class.is-primary]="!physicsEnabled"
                          (click)="updatePhysicsEnabled(false)">
                    <span>Off</span>
                  </button>
                </p>
              </div>
            </footer>
          </div>
        </div>
      </div>
    </div>

    <div class="analysis-view" *ngIf="selectedAnalysisToken">
      <app-analysis-window [(token)]="selectedAnalysisToken"></app-analysis-window>
    </div>
  </div>

  <div class="covex bar-right">

    <div class="card bar-large">
      <header class="card-header">
        <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-info" aria-hidden="true"></i>
      </span> {{currentProteinAc}}
        </p>
      </header>
      <div class="card-content">
        <div *ngIf="showDetails">
          <p><b>Protein Name:</b> {{ currentProteinAc }}</p>
          <p><b>Protein AC(s):</b>
            <a href="https://www.uniprot.org/uniprot/{{proteinAc}}" target="_blank"
               *ngFor="let proteinAc of proteinAcs">
              {{ proteinAc }}
            </a>
          </p>
          <div class="field has-addons add-remove-toggle">
            <p class="control">
              <button class="button is-rounded" [class.is-success]="!inSelection(currentProteinAc)"
                      [disabled]="inSelection(currentProteinAc)"
                      (click)="addToSelection(currentProteinAc)">
                <span class="icon is-small">
                  <i class="fas fa-plus"></i>
                </span>
                <span>Add to Analysis</span>
              </button>
            </p>
            <p class="control">
              <button class="button is-rounded" [class.is-danger]="inSelection(currentProteinAc)"
                      [disabled]="!inSelection(currentProteinAc)"
                      (click)="removeFromSelection(currentProteinAc)">
                <span>Remove</span>
                <span class="icon is-small">
                  <i class="fas fa-trash"></i>
                </span>
              </button>
            </p>
          </div>
        </div>
        <div *ngIf="!showDetails">
          Please select a node for further information.
          <!--          <a (click)="selectedAnalysisToken = 'oy4UsXfBDobTucdQBhN9IUzfnpqKwzqx'"> Open Analysis Window </a>-->
        </div>
      </div>
    </div>

    <div class="card bar-large">
      <header class="card-header">
        <p class="card-header-title">
          <span class="icon">
        <i class="fas fa-flask" aria-hidden="true"></i>
      </span> Analysis
        </p>
      </header>
      <div class="card-content">
        <button (click)="showAnalysisDialog = true"
                class="button is-primary is-fullwidth"
                [disabled]="analysis.getCount() === 0">
          <span class="icon">
            <i class="fa fa-rocket"></i>
          </span>
          <span>
            Launch Analysis
          </span>
        </button>
      </div>
    </div>

    <div class="card bar-large">
      <header class="card-header">
        <p class="card-header-title">
                <span class="icon">
              <i class="fas fa-filter" aria-hidden="true"></i>
            </span> Tasks
        </p>
      </header>
      <div class="card-content overflow">
        <app-task-list [(token)]="selectedAnalysisToken"></app-task-list>
      </div>
      <footer class="card-footer">
        <a (click)="analysis.removeAllTasks();" class="card-footer-item has-text-danger">
          <span class="icon">
              <i class="fa fa-trash"></i>
            </span>
          <span>
              Delete All
            </span>
        </a>
      </footer>
    </div>

    <div class="card bar-large">
      <header class="card-header">
        <p class="card-header-title">
                <span class="icon">
              <i class="fas fa-filter" aria-hidden="true"></i>
            </span> Selection
        </p>
      </header>
      <div class="card-content overflow">
        <table class="table" *ngIf="analysis.getCount() > 0">
          <thead>
          <tr>
            <td>AC</td>
            <td>Actions</td>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let p of analysis.getSelection()">
            <td>{{p.proteinAc}}</td>
            <td>
              <button (click)="analysis.removeProtein(p)" class="button is-small is-danger is-outlined">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
        <i *ngIf="analysis.getCount() === 0">
          To select proteins, click them while pressing CTRL.
        </i>
      </div>
      <footer class="card-footer">
        <a (click)="analysis.resetSelection()" class="card-footer-item has-text-danger">
            <span class="icon">
              <i class="fa fa-refresh"></i>
            </span>
          <span>
              Reset
            </span>
        </a>
      </footer>
    </div>


  </div>

</div>
